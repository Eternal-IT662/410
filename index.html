<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeeSchedule</title>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <style>
        body {
            background: orange;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        h1 { color: white; }
        button {
            margin: 5px;
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            background: #8b1a3d;
            color: white;
            cursor: pointer;
        }
        input {
            margin: 5px;
            padding: 6px;
            border-radius: 5px;
            border: 1px solid #999;
        }
        ul { list-style: none; padding: 0; }
        li {
            background: white;
            margin: 5px;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
        }
        li.selected { background: #ffcccb; }
    </style>
</head>
<body>
    <h1>Welcome to BeeSchedule!</h1>
    <p>Let's Get Start!</p>

    <div id="mainPage" style="display:none;">
        <input id="subject" placeholder="วิชา/เรื่อง" />
        <input id="details" placeholder="รายละเอียด" />
        <input id="dueDate" type="date" />
        <br>
        <button id="addBtn">เพิ่มงาน</button>
        <button id="deleteBtn">ลบงาน</button>
        <ul id="homeworkList"></ul>
    </div>

    <button id="startBtn">Start</button>

    <py-script>
from js import document, localStorage
import json

homework_data = []

def load_data():
    global homework_data
    data = localStorage.getItem("homeworkData")
    if data:
        homework_data = json.loads(data)
    else:
        homework_data = []

def save_data():
    localStorage.setItem("homeworkData", json.dumps(homework_data))

def update_list():
    ul = document.getElementById("homeworkList")
    ul.innerHTML = ""
    homework_data.sort(key=lambda x: x["due_date"])
    for idx, hw in enumerate(homework_data):
        li = document.createElement("li")
        li.innerText = f"{hw['subject']} - {hw['details']} - Due: {hw['due_date']}"
        li.setAttribute("data-selected", str(idx))
        li.addEventListener("click", lambda e, i=idx: on_click(e, i))
        ul.appendChild(li)

def on_click(event, i):
    ul = document.getElementById("homeworkList")
    for el in ul.children:
        el.classList.remove("selected")
    event.target.classList.add("selected")
    ul.setAttribute("data-selected", str(i))

def add_homework(event=None):
    subject = document.getElementById("subject").value.strip()
    details = document.getElementById("details").value.strip()
    due_date = document.getElementById("dueDate").value
    if not subject or not due_date:
        from js import alert
        alert("กรุณากรอกชื่อวิชาและวันที่ส่ง")
        return
    homework_data.append({
        "subject": subject,
        "details": details,
        "due_date": due_date
    })
    save_data()
    update_list()
    document.getElementById("subject").value = ""
    document.getElementById("details").value = ""
    document.getElementById("dueDate").value = ""

def delete_homework(event=None):
    ul = document.getElementById("homeworkList")
    sel = ul.getAttribute("data-selected")
    if sel is None:
        from js import alert
        alert("กรุณาเลือกการบ้านที่จะลบ")
        return
    homework_data.pop(int(sel))
    save_data()
    update_list()
    ul.removeAttribute("data-selected")

def show_main(event=None):
    document.getElementById("startBtn").style.display = "none"
    document.querySelector("p").style.display = "none"
    document.getElementById("mainPage").style.display = "block"
    load_data()
    update_list()

document.getElementById("startBtn").addEventListener("click", show_main)
document.getElementById("addBtn").addEventListener("click", add_homework)
document.getElementById("deleteBtn").addEventListener("click", delete_homework)
    </py-script>
</body>
</html>
