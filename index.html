<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BeeSchedule</title>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <style>
        body {
            background-color: orange;
            font-family: Arial, sans-serif;
            text-align: center;
            color: white;
        }
        #mainPage {
            display: none;
        }
        button {
            margin: 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
        }
        .btn-start { background: #b31237; color: white; }
    </style>
</head>
<body>
    <h1>Welcome to BeeSchedule!</h1>
    <p>Let's Get Start!</p>
    <button id="startBtn" class="btn-start">Start</button>

    <div id="mainPage">
        <input id="subject" placeholder="วิชา">
        <input id="details" placeholder="รายละเอียด">
        <input id="dueDate" type="date">
        <button id="addBtn">เพิ่มการบ้าน</button>
        <button id="deleteBtn">ลบที่เลือก</button>
        <ul id="homeworkList"></ul>
    </div>

    <!-- ✅ โค้ด Python ต้องอยู่ใน py-script -->
    <py-script>
from js import document, localStorage
import json

homework_data = []

def load_data():
    global homework_data
    data = localStorage.getItem("homeworkData")
    if data:
        homework_data = json.loads(data)
    else:
        homework_data = []

def save_data():
    localStorage.setItem("homeworkData", json.dumps(homework_data))

def update_list():
    ul = document.getElementById("homeworkList")
    ul.innerHTML = ""
    homework_data.sort(key=lambda x: x["due_date"])
    for idx, hw in enumerate(homework_data):
        li = document.createElement("li")
        li.innerText = f"{hw['subject']} - {hw['details']} - Due: {hw['due_date']}"
        li.setAttribute("data-selected", str(idx))
        li.onclick = lambda event, i=idx: select_item(i)
        ul.appendChild(li)

def add_homework(event=None):
    subject = document.getElementById("subject").value.strip()
    details = document.getElementById("details").value.strip()
    due_date = document.getElementById("dueDate").value
    if not subject or not due_date:
        from js import alert
        alert("กรุณากรอกชื่อวิชาและวันที่ส่ง")
        return
    homework_data.append({"subject": subject, "details": details, "due_date": due_date})
    save_data()
    update_list()
    document.getElementById("subject").value = ""
    document.getElementById("details").value = ""
    document.getElementById("dueDate").value = ""

def delete_homework(event=None):
    sel = document.querySelector("li.selected")
    if sel is None:
        from js import alert
        alert("กรุณาเลือกการบ้านที่จะลบ")
        return
    idx = int(sel.getAttribute("data-selected"))
    homework_data.pop(idx)
    save_data()
    update_list()

def select_item(idx):
    ul = document.getElementById("homeworkList")
    for el in ul.children:
        el.classList.remove("selected")
    ul.children[idx].classList.add("selected")

def show_main(event=None):
    document.getElementById("startBtn").style.display = "none"
    document.querySelector("p").style.display = "none"
    document.getElementById("mainPage").style.display = "block"
    load_data()
    update_list()

# ผูกปุ่ม
document.getElementById("startBtn").addEventListener("click", show_main)
document.getElementById("addBtn").addEventListener("click", add_homework)
document.getElementById("deleteBtn").addEventListener("click", delete_homework)
    </py-script>
</body>
</html>
